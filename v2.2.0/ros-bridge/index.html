<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>ROS Bridge - Formula Student Driverless Simulator</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "ROS Bridge";
        var mkdocs_page_input_path = "ros-bridge.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Formula Student Driverless Simulator
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../system-overview/">System overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started-with-ros/">Getting started with ROS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../getting-started-with-python/">Getting started with Python</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../custom-mapping/">Getting started with custom mapping</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Vehicle & Sensors</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../vehicle_model/">Vehicle model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../imu/">IMU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lidar/">Lidar</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../camera/">Camera</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gps/">GPS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ground-speed-sensor/">GSS</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">#tech-madness</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">ROS Bridge</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#nodes">Nodes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#published-topics">Published topics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#subscribed-topics">Subscribed topics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#services">Services</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#units">Units</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#coordinate-frames-and-transforms">Coordinate frames and transforms</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#visualization">Visualization</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#monitoring">Monitoring</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../statistics/">ROS Bridge statistics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../joystick/">Joystick</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker_ubuntu/">Docker</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../coordinate-frames/">Coordinate frames</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../import-car-3d-model/">Import your 3d car model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../map-tutorial/">Making your own map in UE4</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gcp-remote-workstation/">Google cloud remote workstation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../software-install-instructions/">Software install instructions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../how-to-release/">How to release</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Competition tooling</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../operator/">Operator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../competition-signals/">System flow and signals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../spectator/">Spectator</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Formula Student Driverless Simulator</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>#tech-madness &raquo;</li>
      <li>ROS Bridge</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/FS-Driverless/Formula-Student-Driverless-Simulator/edit/master/docs/ros-bridge.md">Edit on FS-Driverless/Formula-Student-Driverless-Simulator</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="fsds-ros-bridge">FSDS ROS bridge</h1>
<p><img alt="In action" src="../images/fsds_ros_bridge.png" /></p>
<p>A ROS wrapper over the AirSim C++ <strong>Car</strong> client library. This code is based on the <a href="https://github.com/microsoft/AirSim/tree/master/ros/src/airsim_ros_interface">original AirSim ROS wrapper for the <em>Multirotor</em> API</a> and provides an interface between AirSim + Unreal Engine and your ROS-based autonomous system. </p>
<p>The fsds_ros_bridge is supposed to be launched pointing at the Autonomous System's ROS master so that it can publish and subscribe to topics within the autonomous system. 
Physically this node should run on the airsim simulation server (that is the one that also runs the Unreal) project.
The node connects to the AirSim plugin, periodically retrieves sensor data (images, lidar, imu, gps) and publishes it on ROS topics.
It listens for car setpoints on other another and forwards these to the AirSim plugin.</p>
<h2 id="nodes">Nodes</h2>
<p>The fsds_ros_bridge.launch launches the following nodes:
* <code>/fsds/ros_bridge</code> node responsible for IMU, GPS, lidar, vehicle setpoints and go/finish signals.
* <code>/fsds/camera/CAMERANAME</code> node is run for each camera configured in the <code>settings.json</code>. The nodes are launched using the <code>cameralauncher.py</code> script.</p>
<h2 id="published-topics">Published topics</h2>
<table>
<thead>
<tr>
<th>Topic name</th>
<th>Description</th>
<th>Message</th>
<th>Rate (hz)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/fsds/gps</code></td>
<td>This the current GPS coordinates of the drone in airsim. Read all about the gps simulation model <a href="../gps/">here</a>. Data is in the <code>fsds/FSCar</code> frame.</td>
<td><a href="https://docs.ros.org/api/sensor_msgs/html/msg/NavSatFix.html">sensor_msgs/NavSatFix</a></td>
<td>10</td>
</tr>
<tr>
<td><code>/fsds/imu</code></td>
<td>Velocity, orientation and acceleration information. Read all about the IMU model <a href="../imu/">here</a>. Data is in the <code>fsds/FSCar</code> (enu) frame.</td>
<td><a href="http://docs.ros.org/melodic/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a></td>
<td>250</td>
</tr>
<tr>
<td><code>/fsds/gss</code></td>
<td>Ground speed sensor provide linear velocity of the vehicle (<code>fsds/FSCar</code>). Velocity is m/s.</td>
<td><a href="https://docs.ros.org/api/nav_msgs/html/msg/Odometry.html">geometry_msgs/TwistWithCovarianceStamped</a></td>
<td>100</td>
</tr>
<tr>
<td><code>/fsds/testing_only/odom</code></td>
<td>Ground truth car position and orientation in ENU frame about the CoG of the car (<code>fsds/FSCar</code>).  The units are <code>m</code> for distance. The orientation are expressed in terms of quaternions. The message is in the <code>fsds/map</code> frame. This is a frame that is not (yet) used anywhere else and is just here so you can easely reference it if needed.</td>
<td><a href="https://docs.ros.org/api/nav_msgs/html/msg/Odometry.html">nav_msgs/Odometry</a></td>
<td>250</td>
</tr>
<tr>
<td><code>/fsds/testing_only/track</code></td>
<td>Ground truth cone position and color with respect to the starting location of the car in ENU. Currently this only publishes the <em>initial position</em> of cones that are part of the track spline. Any cones placed manually in the world are not published here. Additionally, the track is published once and the message is latched (meaning it is always available for a newly created subscriber).</td>
<td><a href="https://github.com/FS-Driverless/fs_msgs/blob/master/msg/Track.msg">fs_msgs/Track</a></td>
<td>Latched</td>
</tr>
<tr>
<td><code>/fsds/testing_only/extra_info</code></td>
<td>This topic contains extra information about the simulator. At the moment these are the doo_counter, that keeps track of the amount of cones that have been hit, and the times of the laps</td>
<td><a href="https://github.com/FS-Driverless/fs_msgs/blob/master/msg/ExtraInfo.msg">fs_msgs/ExtraInfo</a></td>
<td>1</td>
</tr>
<tr>
<td><code>/fsds/camera/CAMERA_NAME</code></td>
<td>Camera images. See <a href="camera docs">./camera.md</a>.</td>
<td><a href="https://docs.ros.org/api/sensor_msgs/html/msg/Image.html">sensor_msgs/Image</a></td>
<td>~18</td>
</tr>
<tr>
<td><code>/fsds/lidar/LIDARNAME</code></td>
<td>Publishes the lidar points for each lidar sensor. All points are in the <code>fsds/LIDARNAME</code> frame. Transformations between the <code>fsds/LIDARNAME</code> and <code>fsds/FSCar</code> frame are being published regularly. More info on the lidar sensor can be found <a href="../lidar/">here</a></td>
<td><a href="http://docs.ros.org/melodic/api/sensor_msgs/html/msg/PointCloud.html">sensor_msgs/PointCloud</a></td>
<td><code>`RotationsPerSecond</code> param in <code>settings.json</code></td>
</tr>
<tr>
<td><code>/fsds/signal/go</code></td>
<td>GO signal that is sent every second by the ROS bridge.The car is only allowed to drive once this message has been received. If no GO signal is received for more than 4 seconds, the AS can assume that <code>fsds_ros_bridge</code> has been shut down. This message also includes the mission type and track. More info about signal topics can be found in the <a href="../competition-signals/">competition-signals guide</a></td>
<td><a href="https://github.com/FS-Driverless/fs_msgs/blob/master/msg/GoSignal.msg">fs_msgs/GoSignal</a></td>
<td>1</td>
</tr>
<tr>
<td><code>/tf_static</code></td>
<td>See <a href="#coordinate-frames-and-transforms">Coordinate frames and transforms</a></td>
<td><a href="https://docs.ros.org/api/tf2_msgs/html/msg/TFMessage.html">tf2_msgs/TFMessage</a></td>
<td>1</td>
</tr>
</tbody>
</table>
<h2 id="subscribed-topics">Subscribed topics</h2>
<table>
<thead>
<tr>
<th>Topic name</th>
<th>Description</th>
<th>Message</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/fsds/control_command</code></td>
<td>This message includes the dimensionless values throttle, steering and brake. Throttle and brake range from 0 to 1. For steering <code>-1</code> steers full to the left and <code>+1</code> steers full to the right. Maximum steering angle is by default 25 degrees. The contents of this message fill the essential parts of the <code>msr::airlib::CarApiBase::CarControl</code> struct.  This is the only way to control the car when the airsim ROS client is connected (keyboard will no longer work!).</td>
<td><a href="https://github.com/FS-Driverless/fs_msgs/blob/master/msg/ControlCommand.msg">fs_msgs/ControlCommand</a></td>
</tr>
<tr>
<td><code>/fsds/signal/finished</code></td>
<td>Finished signal that is sent by the AS to stop the mission. The ROS bridge will forward the signal to the operator which in turn will stop the ROS bridge and finish the run.</td>
<td><a href="https://github.com/FS-Driverless/fs_msgs/blob/master/msg/FinishedSignal.msg">fs_msgs/FinishedSignal</a></td>
</tr>
</tbody>
</table>
<h2 id="services">Services</h2>
<ul>
<li><code>/fsds/reset</code> <a href="https://github.com/FS-Driverless/fs_msgs/blob/master/srv/Reset.srv">fs_msgs/Reset</a> <br />
 Resets car to start location.</li>
</ul>
<h2 id="units">Units</h2>
<p>If a topic streams a standard ROS message (like <a href="http://docs.ros.org/melodic/api/sensor_msgs/html/msg/Imu.html">sensor_msgs/Imu</a>) then the units will be the recommended units in the message documentation. Custom messages (from the <a href="https://github.com/FS-Driverless/fs_msgs">fs_msgs</a> package) use the units specified in the message documentation as well. If in doubt, interpret distances in meters, angles in radians and rates in m/s and rad/s, etc.</p>
<h2 id="coordinate-frames-and-transforms">Coordinate frames and transforms</h2>
<p>The primary frame is the <code>fsds/FSCar</code> frame, which is fixed at the center of the car following the <a href="https://www.ros.org/reps/rep-0103.html">ROS coordinate system convention</a>.
The center of the car is the Unreal Engine car pawn position, which in turn is also the center of gravity.</p>
<p>The ROS bridge regularly publishes static transforms between the <code>fsds/FSCar</code> frame and each of the cameras and lidars.
Naming of these frames is <code>fsds/SENSORNAME</code>.
For example, a lidar named <code>Example</code> will publish it's points in the <code>fsds/Example</code> frame.
The position and orientation of a camera named <code>Test</code> will become available in the frame <code>/fsds/Test</code>.</p>
<p>The transforms published on the /tf_static topic are the transforms specified in the <code>settings.json</code>.</p>
<p>Only static transforms within the vehicle are published.</p>
<p>All positions and rotations published by the ROS bridge are in line with <a href="https://www.ros.org/reps/rep-0103.html">the ROS defaults</a>.
This is the same coordinate system as <a href="../coordinate-frames/">everything else within the simulator</a>.</p>
<h2 id="parameters">Parameters</h2>
<ul>
<li>
<p><code>/fsds/ros_bridge/update_gps_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 0.1 seconds (10hz). <br />
  Timer callback frequency for updating and publishing the gps sensordata.
  This value must be equal or higher to the update frequency of the sensor configured in the settings.json</p>
</li>
<li>
<p><code>/fsds/ros_bridge/update_imu_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 0.004 seconds (250hz). <br />
  Timer callback frequency for updating and publishing the imu messages. <br />
  This value must be equal or higher to the minimual sample rate of the sensor configured in the settings.json</p>
</li>
<li>
<p><code>/fsds/ros_bridge/update_gss_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 0.01 seconds (100hz). <br />
  Timer callback frequency for updating and publishing the ground speed sensor messages.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/update_odom_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 0.004 seconds (250hz). <br />
  Timer callback frequency for updating and publishing the odometry.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/publish_static_tf_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 1 seconds (1 hz). <br />
  The frequency at which the static transforms are published.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/update_lidar_every_n_sec</code> [double] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code> <br />
  Default: 0.1 seconds (10 hz). <br />
  The frequency at which the lidar is publshed.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/competition_mode</code> [bool] <br />
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code>
  Default: <code>false</code>, during competition set to <code>true</code>
  If competition mode is enabled, the <code>testing_only</code> topics won't be available.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/manual_mode</code> [bool]
  Set in: <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code>
  Default: <code>false</code>
  Do not enable vehicle api control. You can control the car using the keyboard in the simulator.</p>
</li>
<li>
<p><code>/fsds/ros_bridge/UDP_control</code> [bool]
  Set in <code>$(fsds_ros_bridge)/launch/fsds_ros_bridge.launch</code>
  Default: <code>false</code>
  Force UDP connection for the <code>fsds/controlCommand</code> topic when running the <code>fsds_ros_bridge</code> in WSL</p>
</li>
</ul>
<h2 id="visualization">Visualization</h2>
<p>This package contains some useful launch and config files which will help you in visualizing the data being streamed through the above topics.</p>
<p>To open Rviz with <a href="https://github.com/FS-Driverless/Formula-Student-Driverless-Simulator/blob/master/ros/src/fsds_ros_bridge/config/rviz/default.rviz">this</a> configuration file, run <code>roslaunch fsds_ros_bridge fsds_ros_bridge.launch rviz:=true</code>.</p>
<p>To open Multiplot with <a href="https://github.com/FS-Driverless/Formula-Student-Driverless-Simulator/blob/master/ros/src/fsds_ros_bridge/config/multiplot/multiplot.xml">this</a> configuration file, run <code>roslaunch fsds_ros_bridge fsds_ros_bridge.launch plot:=true</code>.</p>
<h2 id="monitoring">Monitoring</h2>
<p>Performance monitoring of the ROS Bridge is described <a href="../statistics/">here</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ground-speed-sensor/" class="btn btn-neutral float-left" title="GSS"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../statistics/" class="btn btn-neutral float-right" title="ROS Bridge statistics">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>GPLv2</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ground-speed-sensor/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../statistics/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
      <script src="../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
